!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((e||self).UAuthCommon={})}(this,function(e){var r=/*#__PURE__*/function(){function e(r){void 0===r&&(r=e.defaultCreateUrl),this.createURL=void 0,this.createURL=r}return e.defaultCreateUrl=function(e,r){return"https://"+e+".ipns.dweb.link"+r.replace(/^\/?/,"/")},e.prototype.resolve=function(e){try{var r,n,t;if(e.startsWith("/ipfs/")||e.startsWith("/ipns/"))t=e.substring(1,5),r=e.substring(6).split("/")[0],n=e.substring(6+r.length);else{var o=new URL(e);if(""!==o.hash||""!==o.password||""!==o.port||""!==o.search||""!==o.username)throw new Error("invalid ipfs uri");t=o.protocol.substring(0,4),r=o.hostname,n=o.pathname}if("ipfs"!==t)throw new Error("only ipfs is supported, (not ipns)");return Promise.resolve(fetch(this.createURL(r,n)).then(function(e){return e.ok?e.text():Promise.reject(new Error("bad response"))}))}catch(e){return Promise.reject(e)}},e}(),n=/*#__PURE__*/function(){function e(e){this.options=void 0,this.options=e}return e.prototype.resolve=function(e,r){try{var n,t="";if(e.includes("@")){var o=e.split("@",1);t=o[0],n=o[1]}else n=e;var i="http://openid.net/specs/connect/1.0/issuer";return Promise.resolve(this.options.webfingerResolver.resolve(n,t,i,r)).then(function(e){var r,n=null==(r=e.links)?void 0:r.find(function(e){return e.rel===i});if(!n||!n.href)throw new Error("bad jrd");return Promise.resolve(fetch(n.href+"/.well-known/openid-configuration").then(function(e){return e.ok?e.json():Promise.reject(new Error("bad openid-configuration response"))}))})}catch(e){return Promise.reject(e)}},e}();function t(e,r,n){if(!e.s){if(n instanceof o){if(!n.s)return void(n.o=t.bind(null,e,r));1&r&&(r=n.s),n=n.v}if(n&&n.then)return void n.then(t.bind(null,e,r),t.bind(null,e,2));e.s=r,e.v=n;const i=e.o;i&&i(e)}}var o=/*#__PURE__*/function(){function e(){}return e.prototype.then=function(r,n){var o=new e,i=this.s;if(i){var s=1&i?r:n;if(s){try{t(o,1,s(this.v))}catch(e){t(o,2,e)}return o}return this}return this.o=function(e){try{var i=e.v;1&e.s?t(o,1,r?r(i):i):n?t(o,1,n(i)):t(o,2,i)}catch(e){t(o,2,e)}},o},e}();if("undefined"!=typeof window){var i=window;i.UAUTH_VERSION=i.UAUTH_VERSION||{},i.UAUTH_VERSION.COMMON="2.3.0"}var s=/*#__PURE__*/function(){function e(e){this.options=void 0,this.options=e}return e.prototype.resolve=function(e,r,n,i){try{var s=this,u="webfinger."+r+"."+n;return Promise.resolve(s.options.domainResolver.records(e,[u])).then(function(f){function a(e){if(h.subject!==c)throw new Error("resource invalid");return h}var c=r?"acct:"+r+"@"+e:""+e;if(!f[u])return{subject:c,links:[{rel:n,href:i}]};var h,v=JSON.parse(f[u]),l="string"==typeof v.host?Promise.resolve(fetch("/.well-known/webfinger?"+new URLSearchParams({resource:c,rel:n}).toString(),{headers:{Host:v.host}}).then(function(e){return e.ok?e.json():Promise.reject(new Error("bad webfinger response"))})).then(function(e){h=e}):function(){if("string"==typeof v.uri){var e=new URL(v.uri);return function(e,r){var n,i=-1;e:{for(var s=0;s<r.length;s++){var u=r[s][0];if(u){var f=u();if(f&&f.then)break e;if(f===e){i=s;break}}else i=s}if(-1!==i){do{for(var a=r[i][1];!a;)i++,a=r[i][1];var c=a();if(c&&c.then){n=!0;break e}var h=r[i][2];i++}while(h&&!h());return c}}var v=new o,l=t.bind(null,v,2);return(n?c.then(p):f.then(function n(o){for(;;){if(o===e){i=s;break}if(++s===r.length){if(-1!==i)break;return void t(v,1,a)}if(u=r[s][0]){if((o=u())&&o.then)return void o.then(n).then(void 0,l)}else i=s}do{for(var f=r[i][1];!f;)i++,f=r[i][1];var a=f();if(a&&a.then)return void a.then(p).then(void 0,l);var c=r[i][2];i++}while(c&&!c());t(v,1,a)})).then(void 0,l),v;function p(e){for(;;){var n=r[i][2];if(!n||n())break;i++;for(var o=r[i][1];!o;)i++,o=r[i][1];if((e=o())&&e.then)return void e.then(p).then(void 0,l)}t(v,1,e)}}(e.protocol,[[function(){return"http:"}],[function(){return"https:"},function(){return Promise.resolve(fetch(e.toString()).then(function(e){return e.ok?e.json():Promise.reject(new Error("bad webfinger response"))})).then(function(e){h=e})}],[function(){return"ipfs:"},function(){return Promise.resolve(s.options.ipfsResolver.resolve(v.uri)).then(function(e){h=JSON.parse(e)})}],[function(){return"ipns:"}],[function(){return"swarm:"}],[void 0,function(){throw new Error("uri scheme not supported")}]])}if("string"!=typeof v.value)throw new Error("bad webfinger record");h=JSON.parse(v.value)}();return l&&l.then?l.then(a):a()})}catch(e){return Promise.reject(e)}},e}();function u(){return u=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e},u.apply(this,arguments)}var f=/*#__PURE__*/function(){function e(){var e=this;this.map=new Map,this.records=function(r,n){try{var t=e.map.get(r);if(0===n.length)throw new Error("no keys");return Promise.resolve(t?n.reduce(function(e,r){return e[r]=t[r]||"",e},{}):{})}catch(e){return Promise.reject(e)}}}return e.prototype.set=function(e,r){this.map.has(e)?this.map.set(e,u({},this.map.get(e),r)):this.map.set(e,r)},e}(),a=/*#__PURE__*/function(){function e(){this.map=new Map}var r=e.prototype;return r.set=function(e,r,n,t){this.map.set(e+"."+r+"."+n,t)},r.resolve=function(e,r,n,t){try{var o=this.map.get(e+"."+r+"."+n);return Promise.resolve(o||{subject:e,links:[{rel:n,href:t}]})}catch(e){return Promise.reject(e)}},e}();e.DefaultIPFSResolver=r,e.DefaultIssuerResolver=n,e.DefaultWebFingerResolver=s,e.MemoryDomainResolver=f,e.MemoryWebFingerResolver=a,e.isJRD=function(e){return!0},e.isJRDLink=function(e){return!0}});
//# sourceMappingURL=index.umd.js.map
