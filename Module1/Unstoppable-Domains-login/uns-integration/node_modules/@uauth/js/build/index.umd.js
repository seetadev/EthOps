!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@uauth/common"),require("@unstoppabledomains/resolution"),require("global"),require("jose")):"function"==typeof define&&define.amd?define(["@uauth/common","@unstoppabledomains/resolution","global","jose"],t):(e||self).UAuth=t(e.common,e.resolution,e.global,e.jose)}(this,function(e,t,r,n){function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=/*#__PURE__*/o(r);function s(){return s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s.apply(this,arguments)}function u(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function f(e,t,r){return f=l()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&a(o,r.prototype),o},f.apply(null,arguments)}function h(e){var t="function"==typeof Map?new Map:void 0;return h=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return f(e,arguments,c(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)},h(e)}function d(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t.indexOf(r=i[n])>=0||(o[r]=e[r]);return o}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return p(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){/*#__PURE__*/return function(r){function n(){var n;return(n=r.call(this,t)||this).name=e,n}return u(n,r),n}(/*#__PURE__*/h(Error))}var g=m("PopupTimeoutError","The popup has timed out."),_=m("PopupClosedError","The popup was closed."),w=function(e){return String.fromCharCode.apply(null,Array.from(new Uint8Array(e)))},y=new TextEncoder,P=function(){return i.default},b=function(e){return P().btoa(e)},R=function(e){return b(e).replace(/=+$/g,"").replace(/\+/g,"-").replace(/\//g,"_")},S=function(){var e;return null!=(e=P().crypto)?e:P().msCrypto},k=function(e){return S().getRandomValues(new Uint8Array(e))},A=function(){var e;return null!=(e=S().subtle)?e:S().webkitSubtle},O=function(e){try{var t=A().digest({name:"SHA-256"},e);return P().msCrypto?Promise.resolve(new Promise(function(e,r){t.oncomplete=function(t){return e(t.target.result)},t.onerror=function(e){return r(e.error)},t.onabort=function(){return r("The digest operation was aborted")}})):Promise.resolve(t)}catch(e){return Promise.reject(e)}},j="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",T=function(e){return P().atob(e)},I=new TextDecoder;function z(e){return Array.from(new Set(e))}var U=function(e){return z(e.trim().split(/\s+/)).sort().join(" ")};function E(e){var t={};return e.forEach(function(r,n){t[n]=e.getAll(n).length>1?e.getAll(n):e.get(n)}),t}function L(e){var t=new URLSearchParams([].concat(Object.entries(e)).filter(function(e){return null!=e[0]&&null!=e[1]}));return t.sort(),t.toString()}var C={createCodeChallengeAndVerifier:function(e,t){void 0===e&&(e=43),void 0===t&&(t="S256");try{var r=function(e){return Array.from(k(e)).map(function(e){return j[e%j.length]}).join("")}(e);switch(t){case"plain":return Promise.resolve({verifier:r,challenge:r});case"S256":return Promise.resolve(O(y.encode(r).buffer)).then(function(e){return{verifier:r,challenge:R(w(e))}});default:throw new Error("bad challenge method")}}catch(e){return Promise.reject(e)}},getCrypto:S,getCryptoSubtle:A,getRandomBytes:k,sha256:O,verifyIdToken:function(e,t,r,o){try{return Promise.resolve(n.jwtVerify(t,n.createRemoteJWKSet(new URL(e)),{audience:o})).then(function(e){var n=e.payload;if(n.__raw=t,r!==n.nonce)throw new Error("nonces don't match");return n})}catch(e){return Promise.reject(e)}}},x={decodeState:function(e){var t=e.split("."),r=t[1];if(t.slice(2).length>0)throw new Error("failed to decode state");return(null==r?void 0:r.length)>0?JSON.parse(decodeURIComponent(T(r))):void 0},encodeState:function(e){return R(w(k(32)))+"."+(null==e?"":R(encodeURIComponent(JSON.stringify(e))))},fromBase64:T,textDecoder:I,textEncoder:y,toBase64:b,toUrlEncodedBase64:R,stringFromBuffer:w},q={__proto__:null,crypto:C,encoding:x,getSortedScope:U,getWindow:P,objectFromEntries:function(e){for(var t,r={},n=v(e);!(t=n()).done;){var o=t.value;r[o[0]]=o[1]}return r},objectFromURLSearchParams:E,objectToKey:L,retry:function e(t,r,n,o,i){return void 0===r&&(r=4),void 0===n&&(n=250),void 0===o&&(o=2),void 0===i&&(i=null),r<=0?Promise.reject(i):t().catch(function(i){try{return Promise.resolve(new Promise(function(e){return setTimeout(e,n)})).then(function(){return e(t,r-1,n*o,o,i)})}catch(e){return Promise.reject(e)}})},uniqueElementsFromArray:z},D=/*#__PURE__*/function(e){function t(t,r,n){var o;return(o=e.call(this,t+": "+r+(n?"\nSee more at "+n+".":""))||this).code=void 0,o.description=void 0,o.uri=void 0,o.code=t,o.description=r,o.uri=n,o}return u(t,e),t.fromResponse=function(e){return new t(e.error,e.error_description,e.error_uri)},t}(/*#__PURE__*/h(Error)),F=["url"],W=["url","client_id","client_secret","client_auth_method"],N=/*#__PURE__*/function(){function e(e){this.options=void 0,this.options=e}var t=e.prototype;return t.buildAuthorizeUrl=function(e){return this._buildUrl(e)},t.buildLogoutUrl=function(e){return this._buildUrl(e)},t.parseAuthorizeResponseFromFragment=function(e){return this._validateResponse(E(new URLSearchParams(new URL(e).hash.substring(1))))},t.parseAuthorizeResponseFromQuery=function(e){return this._validateResponse(E(new URL(e).searchParams))},t.authorizeWithPopup=function(e,t){void 0===t&&(t={});try{var r,n=this;if(!window)throw new Error("no window in options");var o=n.buildAuthorizeUrl(e),i=t.popup,s=null!=(r=t.timeout)?r:36e5;if(i)i.location.href=o;else{var u,c,a=null!=(u=t.width)?u:600,l=null!=(c=t.height)?c:800;if(!(i=window.open(o,"uauth:authorize:popup","left="+(window.screenX+(window.innerWidth-a)/2)+",top="+(window.screenY+(window.innerHeight-l)/2)+",width="+a+",height="+l+",resizable,scrollbars=yes,status=1")))throw new Error("popup failed to be constructed")}var f=!1;return Promise.resolve(new Promise(function(t,r){var o=setTimeout(function(){f||(clearInterval(u),i.close(),r(new g))},s),u=setInterval(function(){var s,c,a,l;!f&&null!=(s=i)&&s.closed&&(clearInterval(u),clearTimeout(o),r(new _));try{c=i.location.href,a=new URL(c),l=new URL(e.redirect_uri)}catch(e){return}if(a.hash="",a.href===l.href){f=!0,clearInterval(u),clearTimeout(o),i.close();try{t(n.parseAuthorizeResponseFromFragment(c))}catch(e){r(e)}}},10)}))}catch(e){return Promise.reject(e)}},t.authorizeWithDevice=function(e){return Promise.resolve({})},t.getToken=function(e){try{var t=this._buildRequest(e,{method:"POST"});return Promise.resolve(this._fetchJSON(t[0],t[1]))}catch(e){return Promise.reject(e)}},t.introspect=function(e){var t=this._buildRequest(e,{method:"POST"});return this._fetchJSON(t[0],t[1])},t.revoke=function(e){try{var t=this._buildRequest(e,{method:"POST"});return Promise.resolve(this._fetchJSON(t[0],t[1])).then(function(){})}catch(e){return Promise.reject(e)}},t.userinfo=function(e){var t=this._buildRequest(e,{method:"GET",headers:{Authorization:"Basic "+e.access_token}});return this._fetchJSON(t[0],t[1])},t.jwks=function(e){var t=this._buildRequest(e,{method:"GET"});return this._fetchJSON(t[0],t[1])},t.getTokenWithAuthorizationCode=function(e){return this.getToken(e)},t.getTokenWithRefreshToken=function(e){return this.getToken(e)},t.getTokenWithDeviceCode=function(e){return this.getToken(e)},t.getTokenWithPassword=function(e){return this.getToken(e)},t.getTokenWithSAML=function(e){return this.getToken(e)},t.getTokenWithClientCredentials=function(e){return this.getToken(e)},t._buildUrl=function(e){for(var t=e.url,r=d(e,F),n=new URL(t),o=new URLSearchParams,i=0,s=Object.entries(r);i<s.length;i++){var u=s[i],c=u[0],a=u[1];null!=c&&null!=a&&o.append(c,a)}return n.search=o.toString(),n.toString()},t._buildRequest=function(e,t){var r,n=e.url,o=e.client_id,i=e.client_secret,u=e.client_auth_method,c=d(e,W),a=t.headers,l=t.method,f=new Headers(null!=(r=this.options.headers)?r:[]);new Headers(null!=a?a:[]).forEach(function(e,t){f.set(t,e)}),"POST"===t.method&&f.set("Content-Type","application/x-www-form-urlencoded");var h=s({client_id:o},c);switch(u){case"client_secret_basic":if(null==i)throw new Error("Client secret not present!");f.set("Authorization","Basic "+b(o+":"+i));break;case"client_secret_post":if(null==i)throw new Error("Client secret not present!");h.client_secret=i;break;case"none":case void 0:case null:break;default:throw new Error("Bad client_auth_method")}return[n,{method:l,headers:f,body:"POST"===l?new URLSearchParams(Object.entries(h)):void 0}]},t._validateResponse=function(t){if(t.error)throw e.Error.fromResponse(t);return t},t._fetchJSON=function(e,t){try{var r,n=this;if(t.headers){var o=new Headers(t.headers);o.set("Accept","application/json"),t.headers=o}else t.headers={Accept:"application/json"};return Promise.resolve(null==(r=window)?void 0:r.fetch(e,t)).then(function(e){return Promise.resolve(e.json()).then(function(t){if(n._validateResponse(t),!e.ok)throw new Error(e.status+" "+e.statusText+": "+JSON.stringify(t));return t})})}catch(e){return Promise.reject(e)}},e}();N.Error=D;var B=/*#__PURE__*/function(){function e(e){this.client=void 0,this.client=e}var t=e.prototype;return t.get=function(e,t){var r=void 0===t?{}:t,n=r.mustExist,o=void 0!==n&&n,i=r.deleteAfter,s=void 0!==i&&i;try{var u=this;return Promise.resolve(u.client.getStore().get(e)).then(function(t){var r;function n(t){if(r)return t;var n=function(){if(s)return Promise.resolve(u.client.getStore().delete(e)).then(function(){})}();return n&&n.then?n.then(function(){return i}):i}if(null!=t){var i=t.value,c=t.expiresAt,a=function(){if(0!==c&&c<Date.now())return Promise.resolve(u.client.getStore().delete(e)).then(function(){if(o)throw new Error(e+" does not exist in store");r=1})}();return a&&a.then?a.then(n):n(a)}if(o)throw new Error(e+" does not exist in store")})}catch(e){return Promise.reject(e)}},t.set=function(e,t,r){void 0===r&&(r=0);try{return Promise.resolve(this.client.getStore().set(e,{expiresAt:0===r?0:Date.now()+r,value:t})).then(function(){})}catch(e){return Promise.reject(e)}},t.setAuthorizeRequest=function(e){try{return Promise.resolve(this.set("request",e,3e5)).then(function(){})}catch(e){return Promise.reject(e)}},t.getAuthorizeRequest=function(){return this.get("request",{mustExist:!0,deleteAfter:!0})},t.setLogoutRequest=function(e){try{return Promise.resolve(this.set("logout-request",e,3e5)).then(function(){})}catch(e){return Promise.reject(e)}},t.getLogoutRequest=function(){return this.get("logout-request",{mustExist:!0,deleteAfter:!0})},t.setVerifier=function(e,t){try{return Promise.resolve(this.set("verifier:"+e,t,3e5)).then(function(){})}catch(e){return Promise.reject(e)}},t.getVerifier=function(e){return this.get("verifier:"+e,{mustExist:!0,deleteAfter:!0})},t.setOpenIdConfiguration=function(e,t,r){try{return Promise.resolve(this.set("openidConfiguration:"+e,t,r)).then(function(){})}catch(e){return Promise.reject(e)}},t.getOpenIdConfiguration=function(e){return this.get("openidConfiguration:"+e)},t.setAuthorization=function(e){try{var t=this,r={clientID:e.idToken.aud,resource:e.resource,scope:e.scope,username:e.idToken.sub},n=e.expiresAt-Date.now();return Promise.resolve(t.set("username",r.username,n)).then(function(){var o=t.set;return Promise.resolve(t._getAuthorizationKey(r)).then(function(r){return Promise.resolve(o.call(t,r,e,n)).then(function(){})})})}catch(e){return Promise.reject(e)}},t.deleteAuthorization=function(e){try{var t=this;return Promise.resolve(t.get("username")).then(function(r){return Promise.resolve(t._getUsername(e.username,r)).then(function(n){function o(){var r=t.client.getStore(),n=r.delete;return Promise.resolve(t._getAuthorizationKey(e)).then(function(e){return n.call(r,e)})}e.username=n;var i=function(){if(e.username===r)return Promise.resolve(t.client.getStore().delete("username")).then(function(){})}();return i&&i.then?i.then(o):o()})})}catch(e){return Promise.reject(e)}},t.getAuthorization=function(e){try{var t=this,r=t.get;return Promise.resolve(t._getAuthorizationKey(e)).then(function(e){return r.call(t,e,{mustExist:!0})})}catch(e){return Promise.reject(e)}},t._getAuthorizationKey=function(e){try{var t=this,r=L,n=t._getUsername,o=e.username;return Promise.resolve(t.get("username")).then(function(i){return Promise.resolve(n.call(t,o,i)).then(function(n){var o,i,s;return"authorization?"+r.call(q,{username:n,clientID:null!=(o=e.clientID)?o:t.client.fallbackLoginOptions.clientID,scope:U(null!=(i=e.scope)?i:t.client.fallbackLoginOptions.scope),resource:null!=(s=e.resource)?s:t.client.fallbackLoginOptions.resource})})})}catch(e){return Promise.reject(e)}},t._getUsername=function(e,t){try{if(null==e&&null==t)throw new Error("no username given");return Promise.resolve(null!=e?e:t)}catch(e){return Promise.reject(e)}},e}(),M=/*#__PURE__*/function(){function e(e){this.storage=void 0,this.storage=e}var t=e.prototype;return t.get=function(e){var t=this.storage.getItem(e);return null!=t?JSON.parse(t):null},t.delete=function(e){return this.storage.removeItem(e),!0},t.set=function(e,t){return this.storage.setItem(e,JSON.stringify(t)),this},e}(),V="2.4.0",J=["clientID","username","scope","resource"];if("undefined"!=typeof window){var H=window;H.UAUTH_VERSION=H.UAUTH_VERSION||{},H.UAUTH_VERSION.JS=V}var K=/*#__PURE__*/function(){var r=n.prototype;function n(r){var n,o,i,u,c,a,l,f,h,d;this.util=q,this._clientStore=new B(this),this.api=void 0,this.fallbackIssuer=void 0,this.fallbackLoginOptions=void 0,this.fallbackLogoutOptions=void 0,this.cacheOptions=void 0,this.issuerResolver=void 0,this.resolution=void 0,this.store=void 0,this.storeOptions=void 0,this.fallbackIssuer=null!=(n=r.fallbackIssuer)?n:"https://auth.unstoppabledomains.com",this.resolution=null!=(o=r.resolution)?o:new t.Resolution,this.storeOptions={store:r.store,storeType:null!=(i=r.storeType)?i:"localstore"},this.cacheOptions=s({issuer:!1,userinfo:!0},null!=(u=r.cacheOptions)?u:{}),this.api=new N({headers:{}}),this.fallbackLoginOptions={clientID:r.clientID,clientSecret:r.clientSecret,clientAuthMethod:null!=(c=r.clientAuthMethod)?c:r.clientSecret?"client_secret_post":"none",maxAge:null!=(a=r.maxAge)?a:3e5,prompt:null!=(l=r.prompt)?l:"login",resource:r.resource,redirectUri:r.redirectUri,responseMode:null!=(f=r.responseMode)?f:"fragment",scope:null!=(h=r.scope)?h:"openid wallet"},this.fallbackLogoutOptions={rpInitiatedLogout:null!=(d=r.rpInitiatedLogout)?d:"string"==typeof r.postLogoutRedirectUri,postLogoutRedirectUri:r.postLogoutRedirectUri};var p=this;this.issuerResolver=new e.DefaultIssuerResolver({webfingerResolver:new e.DefaultWebFingerResolver({ipfsResolver:new e.DefaultIPFSResolver(function(){return(r.createIpfsUrl||e.DefaultIPFSResolver.defaultCreateUrl).apply(void 0,[].slice.call(arguments))}),domainResolver:{records:function(e,r){try{return Promise.resolve(function(t,n){try{var o=Promise.resolve(p.resolution.records(e,r))}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){if(e instanceof t.ResolutionError&&e.code===t.ResolutionErrorCode.UnspecifiedResolver)return{};throw e}))}catch(e){return Promise.reject(e)}}}})})}return r.getStore=function(){if(this.store)return this.store;if(this.storeOptions.store)this.store=this.storeOptions.store;else switch(this.storeOptions.storeType){case"localstore":this.store=new M(window.localStorage);break;case"sessionstore":this.store=new M(window.sessionStorage);break;case"memory":this.store=new Map;break;default:throw new Error("Bad storeType provided")}return this.store},r.buildAuthorizeRequest=function(e){try{var t=this,r=s({},t.fallbackLoginOptions,e),n=e.username;return Promise.resolve(t.getOpenIdConfiguration(n)).then(function(e){return Promise.resolve(C.createCodeChallengeAndVerifier(43,"S256")).then(function(o){var i,s=o.verifier,u=o.challenge,c=x.toBase64(x.stringFromBuffer(C.getRandomBytes(32))),a=x.encodeState(r.state),l={url:e.authorization_endpoint,code_challenge:u,nonce:c,state:a,flow_id:null!=(i=r.flowId)?i:"login",login_hint:n,client_id:r.clientID,client_secret:r.clientSecret,client_auth_method:r.clientAuthMethod,max_age:r.maxAge,prompt:r.prompt,resource:r.resource,redirect_uri:r.redirectUri,response_mode:r.responseMode,scope:r.scope,code_challenge_method:"S256",response_type:"code",package_name:(null==r?void 0:r.packageName)||"@uauth/js",package_version:(null==r?void 0:r.packageVersion)||V};return Promise.resolve(t._clientStore.setAuthorizeRequest(l)).then(function(){return Promise.resolve(t._clientStore.setVerifier(u,s)).then(function(){return l})})})})}catch(e){return Promise.reject(e)}},r.loginWithPopup=function(e,t){void 0===e&&(e={});try{var r=this;return e.responseMode="fragment",Promise.resolve(r.buildAuthorizeRequest(e)).then(function(e){return Promise.resolve(r.api.authorizeWithPopup(e,t)).then(function(t){return Promise.resolve(r.verifyAuthorizeResponse(e,t))})})}catch(e){return Promise.reject(e)}},r.login=function(e){void 0===e&&(e={});try{var t=this;return Promise.resolve(t.buildAuthorizeRequest(e)).then(function(r){function n(){window.location.href=o}var o=t.api.buildAuthorizeUrl(r),i=function(){if("function"==typeof e.beforeRedirect)return Promise.resolve(e.beforeRedirect(o)).then(function(){})}();return i&&i.then?i.then(n):n()})}catch(e){return Promise.reject(e)}},r.loginCallback=function(e){try{var t,r=this,n=null!=(t=null==e?void 0:e.url)?t:window.location.href;return Promise.resolve(r._clientStore.getAuthorizeRequest()).then(function(e){var t;if("fragment"===e.response_mode)t=r.api.parseAuthorizeResponseFromFragment(n);else{if("query"!==e.response_mode)throw new Error("Unsupported response_mode");t=r.api.parseAuthorizeResponseFromQuery(n)}return Promise.resolve(r.verifyAuthorizeResponse(e,t)).then(function(t){return{authorization:t,state:x.decodeState(e.state)}})})}catch(e){return Promise.reject(e)}},r.verifyAuthorizeResponse=function(e,t){try{var r=this;if(e.state!==t.state)throw new Error("states don't match");return Promise.resolve(r.getOpenIdConfiguration(e.login_hint)).then(function(n){var o=t.code,i=e.client_auth_method,s=e.client_secret,u=e.client_id,c=n.token_endpoint;return Promise.resolve(r._clientStore.getVerifier(e.code_challenge)).then(function(t){return Promise.resolve(r.api.getTokenWithAuthorizationCode({url:c,client_id:u,client_secret:s,client_auth_method:i,grant_type:"authorization_code",code:o,code_verifier:t,redirect_uri:e.redirect_uri})).then(function(t){return Promise.resolve(C.verifyIdToken(n.jwks_uri,t.id_token,e.nonce,e.client_id)).then(function(n){var o={accessToken:t.access_token,expiresAt:Date.now()+1e3*t.expires_in,idToken:n,scope:U(e.scope),resource:e.resource};return Promise.resolve(r._clientStore.setAuthorization(o)).then(function(){return o})})})})})}catch(e){return Promise.reject(e)}},r.getVerifiedAccounts=function(e,t){void 0===t&&(t=[]);var r=[];return e.idToken.verified_addresses?(e.idToken.verified_addresses.forEach(function(e){t.length>0&&!t.includes(e.symbol)||r.push({address:e.address,message:e.proof.message,signature:e.proof.signature,symbol:e.symbol})}),r):r},r.getAuthorizationAccount=function(e,t,r){var n;void 0===t&&(t="sig"),void 0===r&&(r="v1");var o=null==(n=e.idToken.amr)?void 0:n.filter(function(e){return e.startsWith(r+"."+t)});if(o&&0!=o.length){var i=o[0].split(".")[3],s=this.getVerifiedAccounts(e);if(s)for(var u,c=v(s);!(u=c()).done;){var a=u.value;if(a.address===i)return a}}},r.getOpenIdConfiguration=function(e){try{var t,r=function(r){return t?r:Promise.resolve(e?n.issuerResolver.resolve(e,n.fallbackIssuer):fetch(n.fallbackIssuer+"/.well-known/openid-configuration").then(function(e){return e.ok?e.json():Promise.reject(new Error("bad openid-configuration response"))})).then(function(t){return Promise.resolve(n._clientStore.setOpenIdConfiguration(null!=e?e:"",t,"number"==typeof n.cacheOptions.issuer?n.cacheOptions.issuer:36e5)).then(function(){return t})})},n=this,o=function(){if(n.cacheOptions.issuer)return Promise.resolve(n._clientStore.getOpenIdConfiguration(null!=e?e:"")).then(function(e){if(e)return t=1,e})}();return Promise.resolve(o&&o.then?o.then(r):r(o))}catch(e){return Promise.reject(e)}},r.authorization=function(e){void 0===e&&(e={});try{return Promise.resolve(this._clientStore.getAuthorization(e))}catch(e){return Promise.reject(e)}},r.user=function(e){void 0===e&&(e={});try{var t,r=this,n=null!=(t=e.claims)?t:["name","given_name","family_name","middle_name","nickname","preferred_username","profile","picture","website","email","email_verified","gender","birthdate","zoneinfo","locale","phone_number","phone_number_verified","address","updated_at","wallet_address","wallet_type_hint","eip4361_message","eip4361_signature","humanity_check_id"];return Promise.resolve(r.authorization(e)).then(function(e){var t={sub:e.idToken.sub};if(r.cacheOptions.userinfo){for(var o,i=v(n);!(o=i()).done;){var s=o.value;e.idToken[s]&&(t[s]=e.idToken[s])}return t}return Promise.resolve(r.getOpenIdConfiguration(e.idToken.sub)).then(function(o){return Promise.resolve(r.api.userinfo({client_id:r.fallbackLoginOptions.clientID,client_secret:r.fallbackLoginOptions.clientSecret,client_auth_method:r.fallbackLoginOptions.clientAuthMethod,access_token:e.accessToken,url:o.userinfo_endpoint})).then(function(e){for(var r,o=v(n);!(r=o()).done;){var i=r.value;e[i]&&(t[i]=e[i])}return t})})})}catch(e){return Promise.reject(e)}},r.buildLogoutRequest=function(e){try{var t=this;return Promise.resolve(t.authorization(e)).then(function(r){return Promise.resolve(t.getOpenIdConfiguration(r.idToken.sub)).then(function(n){var o;if(null==n.end_session_endpoint)throw new Error("end_session_endpoint must exist");var i=null!=(o=e.postLogoutRedirectUri)?o:t.fallbackLogoutOptions.postLogoutRedirectUri;if(null==i)throw new Error("postLogoutRedirectUri must be supplied");var s={client_id:t.fallbackLoginOptions.clientID,client_secret:t.fallbackLoginOptions.clientSecret,client_auth_method:t.fallbackLoginOptions.clientAuthMethod,url:n.end_session_endpoint,id_token_hint:r.idToken.__raw,post_logout_redirect_uri:i,state:x.encodeState(e.state)};return Promise.resolve(t._clientStore.setLogoutRequest(s)).then(function(){return s})})})}catch(e){return Promise.reject(e)}},r.logout=function(e){var t=void 0===e?{}:e,r=t.clientID,n=t.username,o=t.scope,i=t.resource,u=d(t,J);try{var c,a=function(e){return c?e:Promise.resolve(l.buildLogoutRequest(f)).then(function(e){function t(){return Promise.resolve(l._clientStore.deleteAuthorization(h)).then(function(){window.location.href=r})}var r=l.api.buildLogoutUrl(e),n=function(){if("function"==typeof f.beforeRedirect)return Promise.resolve(f.beforeRedirect(r)).then(function(){})}();return n&&n.then?n.then(t):t()})},l=this,f=s({},l.fallbackLogoutOptions,u),h={clientID:r,username:n,scope:o,resource:i},p=function(){if(!f.rpInitiatedLogout)return Promise.resolve(l._clientStore.deleteAuthorization(h)).then(function(){c=1})}();return Promise.resolve(p&&p.then?p.then(a):a(p))}catch(e){return Promise.reject(e)}},r.logoutCallback=function(e){void 0===e&&(e={});try{var t,r,n=this,o=null!=(t=null==(r=e)?void 0:r.url)?t:window.location.href;return Promise.resolve(n._clientStore.getLogoutRequest()).then(function(e){var t=n.api.parseAuthorizeResponseFromQuery(o);return Promise.resolve(n.verifyLogoutResponse(e,t)).then(function(){return x.decodeState(e.state)})})}catch(e){return Promise.reject(e)}},r.verifyLogoutResponse=function(e,t){try{if(e.state!==t.state)throw new Error("states don't match");return Promise.resolve()}catch(e){return Promise.reject(e)}},n}();return K});
//# sourceMappingURL=index.umd.js.map
